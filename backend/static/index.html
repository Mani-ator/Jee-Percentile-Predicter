<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JEE Percentile Predictor</title>
    <link rel="icon" href="https://img.icons8.com/fluency/48/star.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        body {
            margin: 0; padding: 0;
            background-color: #01030a;
            color: white;
            font-family: 'Plus Jakarta Sans', sans-serif;
            overflow: hidden; height: 100vh;
        }

        #canvas { position: fixed; inset: 0; z-index: 1; }

        .nebula {
            position: fixed; inset: 0;
            background: 
                radial-gradient(circle at 15% 15%, rgba(37, 99, 235, 0.12) 0%, transparent 40%),
                radial-gradient(circle at 85% 85%, rgba(147, 51, 234, 0.12) 0%, transparent 40%);
            z-index: 2; pointer-events: none;
        }

        .ui-container {
            position: fixed; inset: 0;
            display: flex; justify-content: center; align-items: center;
            z-index: 10; pointer-events: none;
        }

        .glass-box {
            background: rgba(8, 12, 24, 0.85);
            backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 32px;
            padding: 48px; width: 460px;
            pointer-events: auto;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            transition: all 0.5s ease;
        }

        select, input {
            background: rgba(255, 255, 255, 0.05) !important;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1) !important;
            border-radius: 16px !important;
            padding: 14px 18px !important;
            width: 100%; color: white; font-size: 14px; 
            outline: none; transition: all 0.3s ease;
            appearance: none; cursor: pointer;
        }

        select option { background-color: #080c18; color: white; }

        select:focus, input:focus { 
            border-color: rgba(251, 191, 36, 0.5) !important; 
            background: rgba(255, 255, 255, 0.1) !important;
            box-shadow: 0 0 15px rgba(251, 191, 36, 0.2);
        }

        .btn-action {
            background: #ffffff; color: #000000; 
            font-weight: 800; border-radius: 16px;
            text-transform: uppercase; letter-spacing: 1.5px; 
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            cursor: pointer;
        }

        .btn-action:hover:not(:disabled) { 
            background: #fbbf24; transform: scale(1.02);
            box-shadow: 0 0 30px rgba(251, 191, 36, 0.3);
        }

        .btn-action:disabled { opacity: 0.5; cursor: not-allowed; }

        .marquee-container {
            position: fixed; bottom: 0; width: 100%;
            background: rgba(0,0,0,0.4); padding: 12px 0; z-index: 20;
            border-top: 1px solid rgba(255, 255, 255, 0.05);
            overflow: hidden;
        }

        .marquee-text {
            display: inline-block; 
            white-space: nowrap;
            animation: scroll 150s linear infinite;
            color: rgba(255, 255, 255, 0.3); 
            font-size: 10px; 
            letter-spacing: 4px; 
            font-weight: 600; 
            text-transform: uppercase;
            padding-left: 100%;
        }

        @keyframes scroll { 
            0% { transform: translateX(0); } 
            100% { transform: translateX(-100%); } 
        }
        
        @keyframes glow-pulse {
            0%, 100% { box-shadow: 0 0 40px rgba(251, 191, 36, 0.1); }
            50% { box-shadow: 0 0 80px rgba(251, 191, 36, 0.2); }
        }

        .glass-box.revealed {
            border-color: rgba(251, 191, 36, 0.3);
            animation: glow-pulse 4s infinite ease-in-out;
        }
    </style>
</head>
<body>

    <canvas id="canvas"></canvas>
    <div class="nebula"></div>

    <div class="ui-container">
        <div class="glass-box" id="main-box">
            <h1 class="text-3xl font-extrabold tracking-tight mb-2 text-center">Check Percentile</h1>
            <p class="text-yellow-500 text-[10px] font-bold tracking-[0.5em] uppercase mb-10 opacity-80 text-center">STUDYYYYYYYYYY!!!!!!!!!!</p>

            <div class="space-y-6">
                <div class="grid grid-cols-2 gap-4">
                    <div class="space-y-2">
                        <label class="text-[9px] uppercase tracking-widest text-slate-500 ml-1">Select Year</label>
                        <select id="year" onchange="updateDates()">
                            <option value="" disabled selected>BATCH</option>
                        </select>
                    </div>
                    <div class="space-y-2">
                        <label class="text-[9px] uppercase tracking-widest text-slate-500 ml-1">Exam Date</label>
                        <select id="date">
                            <option value="" disabled selected>DATE</option>
                        </select>
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div class="space-y-2">
                        <label class="text-[9px] uppercase tracking-widest text-slate-500 ml-1">Shift</label>
                        <select id="shift">
                            <option value="Morning">Morning</option>
                            <option value="Evening">Evening</option>
                        </select>
                    </div>
                    <div class="space-y-2">
                        <label class="text-[9px] uppercase tracking-widest text-slate-500 ml-1">Enter Score</label>
                        <input type="number" id="marks" placeholder="0 - 300" min="0" max="300">
                    </div>
                </div>
                <button id="predict-btn" onclick="getPrediction()" class="btn-action w-full py-4 mt-4 text-xs">Analyze</button>
            </div>

            <div id="result" class="hidden mt-10 pt-8 border-t border-white/10 grid grid-cols-2 gap-6">
                <div class="text-center">
                    <p class="text-[9px] text-slate-500 uppercase tracking-widest mb-1">Percentile</p>
                    <h2 id="perc-display" class="text-3xl font-bold">--</h2>
                </div>
                <div class="text-center border-l border-white/5">
                    <p class="text-[9px] text-slate-500 uppercase tracking-widest mb-1">Est. Rank</p>
                    <h2 id="rank-display" class="text-3xl font-bold text-yellow-500">--</h2>
                </div>
            </div>
        </div>
    </div>

    <div class="marquee-container">
        <div class="marquee-text">
            "Education is not the filling of a pail, but the lighting of a fire" &nbsp;&nbsp;•&nbsp;&nbsp; 
            "The beautiful thing about learning is that no one can take it away from you" &nbsp;&nbsp;•&nbsp;&nbsp; 
            "Success is the sum of small efforts, repeated day in and day out" &nbsp;&nbsp;•&nbsp;&nbsp; 
            "It does not matter how slowly you go as long as you do not stop" &nbsp;&nbsp;•&nbsp;&nbsp; 
            "The expert in anything was once a beginner" &nbsp;&nbsp;•&nbsp;&nbsp; 
            "Fall seven times, stand up eight" &nbsp;&nbsp;•&nbsp;&nbsp; 
            "Mistakes are proof that you are trying" &nbsp;&nbsp;•&nbsp;&nbsp; 
            "Education is the most powerful weapon which you can use to change the world" &nbsp;&nbsp;•&nbsp;&nbsp; 
            "Live as if you were to die tomorrow. Learn as if you were to live forever" &nbsp;&nbsp;•&nbsp;&nbsp; 
            "The more that you read, the more things you will know" &nbsp;&nbsp;•&nbsp;&nbsp; 
            "Knowledge is the only investment that pays the best interest" &nbsp;&nbsp;•&nbsp;&nbsp; 
            "Learning is a treasure that will follow its owner everywhere" &nbsp;&nbsp;•&nbsp;&nbsp; 
            "The mind is not a vessel to be filled, but a fire to be kindled" &nbsp;&nbsp;•&nbsp;&nbsp; 
            "Wisdom is not a product of schooling but of the lifelong attempt to acquire it" &nbsp;&nbsp;•&nbsp;&nbsp; 
            "The roots of education are bitter, but the fruit is sweet" &nbsp;&nbsp;•&nbsp;&nbsp; 
            "Don't let what you cannot do interfere with what you can do" &nbsp;&nbsp;•&nbsp;&nbsp; 
            "The capacity to learn is a gift; the ability to learn is a skill; the willingness to learn is a choice" &nbsp;&nbsp;•&nbsp;&nbsp; 
            "Aim for success, not perfection. Never give up your right to be wrong" &nbsp;&nbsp;•&nbsp;&nbsp; 
            "Study while others are sleeping and prepare while others are playing" &nbsp;&nbsp;•&nbsp;&nbsp; 
            "There is no end to education. It is a lifelong journey" &nbsp;&nbsp;•&nbsp;&nbsp; 
            "Education is what survives when what has been learned has been forgotten"
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        let width, height, stars = [];
        let mouse = { x: -2000, y: -2000 };
        let shootingStar = { x: 0, y: 0, vx: 0, vy: 0, active: false, len: 0, opacity: 0 };

        // YOUR UPDATED RAILWAY BACKEND URL
        const API_BASE = "https://jee-percentile-predicter-production.up.railway.app";

        function init() {
            width = canvas.width = window.innerWidth;
            height = canvas.height = window.innerHeight;
            stars = Array.from({length: 250}, () => ({
                x: Math.random() * width,
                y: Math.random() * height,
                bx: 0, by: 0,
                s: Math.random() * 1.5 + 0.5,
                opacity: Math.random(),
                twinkle: Math.random() * 0.01 + 0.005
            }));
            stars.forEach(s => { s.bx = s.x; s.by = s.y; });
        }

        function createShootingStar() {
            if (shootingStar.active) return;
            shootingStar = {
                x: Math.random() * width,
                y: Math.random() * (height / 2),
                vx: (Math.random() * 10) + 5,
                vy: (Math.random() * 5) + 2,
                active: true,
                len: (Math.random() * 80) + 50,
                opacity: 1
            };
        }

        function loop() {
            ctx.fillStyle = '#01030a';
            ctx.fillRect(0, 0, width, height);

            ctx.beginPath();
            for (let i = 0; i < stars.length; i++) {
                for (let j = i + 1; j < stars.length; j++) {
                    const d = Math.hypot(stars[i].x - stars[j].x, stars[i].y - stars[j].y);
                    if (d < 100) {
                        ctx.strokeStyle = `rgba(255, 255, 255, ${0.1 * (1 - d / 100)})`;
                        ctx.lineWidth = 0.5;
                        ctx.moveTo(stars[i].x, stars[i].y);
                        ctx.lineTo(stars[j].x, stars[j].y);
                    }
                }
            }
            ctx.stroke();

            stars.forEach((s) => {
                const dx = mouse.x - s.x;
                const dy = mouse.y - s.y;
                const dist = Math.hypot(dx, dy);
                if (dist < 150) {
                    const angle = Math.atan2(dy, dx);
                    const force = (150 - dist) / 150;
                    s.x -= Math.cos(angle) * force * 5;
                    s.y -= Math.sin(angle) * force * 5;
                }
                s.x += (s.bx - s.x) * 0.03;
                s.y += (s.by - s.y) * 0.03;
                s.opacity += s.twinkle;
                if (s.opacity > 1 || s.opacity < 0.2) s.twinkle *= -1;
                
                ctx.fillStyle = `rgba(255, 255, 255, ${s.opacity})`;
                ctx.beginPath(); ctx.arc(s.x, s.y, s.s, 0, Math.PI*2); ctx.fill();
            });

            if (Math.random() < 0.005) createShootingStar();

            if (shootingStar.active) {
                shootingStar.x += shootingStar.vx;
                shootingStar.y += shootingStar.vy;
                shootingStar.opacity -= 0.015;

                if (shootingStar.opacity <= 0) {
                    shootingStar.active = false;
                } else {
                    ctx.strokeStyle = `rgba(251, 191, 36, ${shootingStar.opacity})`;
                    ctx.lineWidth = 2;
                    ctx.beginPath();
                    ctx.moveTo(shootingStar.x, shootingStar.y);
                    ctx.lineTo(shootingStar.x - shootingStar.vx * 10, shootingStar.y - shootingStar.vy * 10);
                    ctx.stroke();
                }
            }
            requestAnimationFrame(loop);
        }

        async function updateDates() {
            const y = document.getElementById('year').value;
            if(!y) return;
            try {
                const res = await fetch(`${API_BASE}/get_dates?year=${y}`);
                if (!res.ok) throw new Error("Backend response error");
                const data = await res.json();
                const ds = document.getElementById('date');
                ds.innerHTML = '<option value="" disabled selected>DATE</option>' + 
                               data.map(d => `<option value="${d}">${d}</option>`).join('');
            } catch(e) { 
                console.error("Could not fetch dates:", e); 
            }
        }

        async function getPrediction() {
            const year = document.getElementById('year').value;
            const date = document.getElementById('date').value;
            const shift = document.getElementById('shift').value;
            const marks = document.getElementById('marks').value;
            
            if(!year || !date || !shift || !marks) {
                return alert("Please select all cosmic coordinates.");
            }

            const btn = document.getElementById('predict-btn');
            btn.innerText = "CALCULATING..."; 
            btn.disabled = true;

            try {
                const response = await fetch(`${API_BASE}/predict?year=${year}&date=${date}&shift=${shift}&marks=${marks}`);
                const data = await response.json();
                
                if(data.error) {
                    alert(data.error);
                } else {
                    const resDiv = document.getElementById('result');
                    resDiv.classList.remove('hidden');
                    document.getElementById('main-box').classList.add('revealed');
                    document.getElementById('perc-display').innerText = data.percentile;
                    document.getElementById('rank-display').innerText = data.predicted_rank.toLocaleString();
                }
            } catch(e) { 
                alert("Failed to connect to the backend. Check console (F12)."); 
            } finally { 
                btn.innerText = "ANALYZE"; 
                btn.disabled = false; 
            }
        }

        window.onmousemove = e => { mouse.x = e.clientX; mouse.y = e.clientY; };
        
        window.onload = async () => {
            init(); loop();
            console.log("Connecting to API at:", API_BASE);
            try {
                const res = await fetch(`${API_BASE}/get_years`);
                if (!res.ok) throw new Error("Server status: " + res.status);
                const years = await res.json();
                console.log("Successfully fetched years:", years);
                const yearSelect = document.getElementById('year');
                yearSelect.innerHTML = '<option value="" disabled selected>BATCH</option>' + 
                                       years.map(y => `<option value="${y}">${y}</option>`).join('');
            } catch(e) { 
                console.error("Critical: Could not fetch years.", e);
                alert("Data loading failed. Check if your database is connected in Railway.");
            }
        };

        window.onresize = init;
    </script>
</body>
</html>
